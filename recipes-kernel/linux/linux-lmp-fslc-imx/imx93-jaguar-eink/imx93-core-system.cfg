# iMX93 Core System Configuration for E-Ink Board
# Consolidated from: drivers-essential-only.cfg, disable-unused-features.cfg, 
# kernel-config-cleanup.cfg, imx9-soc-fixes.cfg, cortex-m33-support.cfg
# 
# This file contains all essential drivers, disabled unused features,
# iMX93 SoC fixes, and Cortex-M33 support for the E-Ink board

# === Essential System Drivers ===
CONFIG_SERIAL=y
CONFIG_SERIAL_FSL_LPUART=y
CONFIG_SERIAL_FSL_LPUART_CONSOLE=y
CONFIG_SERIAL_CORE=y
CONFIG_SERIAL_CORE_CONSOLE=y

# GPIO Support (essential for E-Ink board)
CONFIG_GPIOLIB=y
CONFIG_GPIO_SYSFS=y
CONFIG_GPIO_MXC=y
CONFIG_GPIO_GENERIC=y

# === Graphics/Display for E-Ink (Framebuffer only) ===
# E-Ink displays use SPI + framebuffer, not DRM
CONFIG_DRM=n
CONFIG_DRM_KMS_HELPER=n
CONFIG_DRM_GEM_DMA_HELPER=n
CONFIG_DRM_PANEL=n
CONFIG_DRM_BRIDGE=n
CONFIG_DRM_PANEL_SIMPLE=n
CONFIG_DRM_IMX=n
CONFIG_DRM_IMX_DCSS=n
CONFIG_DRM_IMX_LCDIF=n
CONFIG_DRM_IMX_PARALLEL=n
CONFIG_IMX_DPU_CORE=n
CONFIG_IMX_LCDIF_CORE=n
CONFIG_IMX_DCSS_CORE=n

# ARM Mali GPU drivers (not present on iMX93)
CONFIG_DRM_PANFROST=n         # ARM Mali Midgard/Bifrost GPUs
CONFIG_DRM_LIMA=n             # ARM Mali 400/450 GPUs  
CONFIG_DRM_ETNAVIV=n          # Vivante GPU driver

# === Memory Management ===
CONFIG_MMC=y
CONFIG_MMC_BLOCK=y
CONFIG_MMC_SDHCI=y
CONFIG_MMC_SDHCI_PLTFM=y
CONFIG_MMC_SDHCI_ESDHC_IMX=y

# === I2C Support (essential for E-Ink board) ===
CONFIG_I2C=y
CONFIG_I2C_CHARDEV=y
CONFIG_I2C_IMX=y

# === SPI Support (essential for E-Ink display) ===
CONFIG_SPI=y
CONFIG_SPI_IMX=y
CONFIG_SPI_SPIDEV=y

# === USB Support ===
CONFIG_USB=y
CONFIG_USB_COMMON=y
CONFIG_USB_SUPPORT=y
CONFIG_USB_ARCH_HAS_HCD=y
CONFIG_USB_EHCI_HCD=y
CONFIG_USB_EHCI_MXC=y
CONFIG_USB_CHIPIDEA=y
CONFIG_USB_CHIPIDEA_UDC=y
CONFIG_USB_CHIPIDEA_HOST=y

# === Clocks and Regulators ===
CONFIG_COMMON_CLK=y
CONFIG_REGULATOR=y
CONFIG_REGULATOR_FIXED_VOLTAGE=y
CONFIG_REGULATOR_GPIO=y

# === Disabled Unused Features ===
# Graphics acceleration (not needed for E-Ink)
CONFIG_DRM_MSM=n              # Qualcomm Adreno GPU
CONFIG_DRM_TEGRA=n            # NVIDIA Tegra GPU
CONFIG_DRM_NOUVEAU=n          # NVIDIA GPU driver
CONFIG_DRM_RADEON=n           # AMD Radeon GPU
CONFIG_DRM_AMDGPU=n           # AMD GPU driver
CONFIG_DRM_I915=n             # Intel graphics
CONFIG_DRM_XE=n               # Intel Xe graphics
CONFIG_DRM_V3D=n              # Broadcom V3D GPU
CONFIG_DRM_VC4=n              # Broadcom VideoCore IV
CONFIG_DRM_ROCKCHIP=n         # Rockchip GPU
CONFIG_DRM_MEDIATEK=n         # MediaTek GPU
CONFIG_DRM_TILCDC=n           # TI LCDC
CONFIG_DRM_STI=n              # STMicroelectronics
CONFIG_DRM_ATMEL_HLCDC=n      # Atmel HLCDC
CONFIG_DRM_MXSFB=n            # MXS framebuffer

# Network drivers not present on iMX93
CONFIG_NET_VENDOR_INTEL=n     # Intel network adapters
CONFIG_NET_VENDOR_REALTEK=n   # Realtek network adapters  
CONFIG_NET_VENDOR_BROADCOM=n  # Broadcom network adapters
CONFIG_NET_VENDOR_MARVELL=n   # Marvell network adapters

# USB controllers not present
CONFIG_USB_XHCI_PCI=n         # PCIe xHCI controller
CONFIG_USB_EHCI_PCI=n         # PCIe EHCI controller
CONFIG_USB_OHCI_PCI=n         # PCIe OHCI controller

# PCIe support (iMX93 has no PCIe hardware, but enable for driver compilation)
CONFIG_PCI=y                  # PCI bus support (needed for NXP WiFi driver compilation)
CONFIG_PCI_DOMAINS=y          # PCI domain support (needed for PCI subsystem)
CONFIG_PCI_MSI=y              # PCI MSI support (needed for struct msix_entry)
CONFIG_PCIEPORTBUS=n          # PCIe port services (disabled - no hardware)
CONFIG_PCIEASPM=n             # PCIe ASPM support (disabled - no hardware)
CONFIG_PCIE_IMX=n             # iMX PCIe controller (disabled - not present on iMX93)

# Wireless drivers not present
CONFIG_ATH_CARDS=n            # Atheros wireless
CONFIG_IWLWIFI=n              # Intel wireless
CONFIG_RTL_CARDS=n            # Realtek wireless
CONFIG_BRCMFMAC_PCIE=n        # Broadcom PCIe wireless

# Storage controllers not present
CONFIG_ATA=n                  # SATA/PATA support
CONFIG_SATA_AHCI=n            # AHCI SATA
CONFIG_NVME_CORE=n            # NVMe storage

# Power management conflicts
CONFIG_INTEL_IDLE=n           # Intel idle driver
CONFIG_ACPI=n                 # ACPI support (ARM uses device tree)
CONFIG_X86_INTEL_PSTATE=n     # Intel P-state driver

# CPU architecture specific
CONFIG_X86_64=n               # x86_64 architecture
CONFIG_X86=n                  # x86 architecture  
CONFIG_MIPS=n                 # MIPS architecture
CONFIG_RISCV=n                # RISC-V architecture

# Virtualization (not needed for embedded)
CONFIG_VIRTUALIZATION=n       # Virtualization support
CONFIG_KVM=n                  # Kernel Virtual Machine
CONFIG_XEN=n                  # Xen hypervisor

# === iMX93 SoC Specific Fixes ===
# Fix for iMX93 11x11 EVK compatibility
CONFIG_IMX_WEIM=y
CONFIG_IMX_SDMA=y

# iMX93 specific pinctrl
CONFIG_PINCTRL_IMX93=y
CONFIG_PINCTRL_IMX=y

# iMX93 clock support
CONFIG_CLK_IMX93=y

# === Cortex-M33 Support ===
# Remote processor framework for Cortex-M33 core
CONFIG_REMOTEPROC=y
CONFIG_IMX_REMOTEPROC=y

# Mailbox support for inter-core communication
CONFIG_MAILBOX=y
CONFIG_IMX_MBOX=y

# Shared memory support
CONFIG_RPMSG=y
CONFIG_RPMSG_VIRTIO=y

# === Security and NVMEM ===
CONFIG_NVMEM=y
CONFIG_NVMEM_SYSFS=y
CONFIG_NVMEM_IMX_OCOTP=y

# === Essential Kernel Features ===
CONFIG_MODULES=y
CONFIG_MODULE_UNLOAD=y
CONFIG_SYSFS=y
CONFIG_PROC_FS=y
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y

# === Container and Docker Support ===
# Essential kernel modules and features required for Docker runtime
CONFIG_NAMESPACES=y
CONFIG_UTS_NS=y
CONFIG_IPC_NS=y
CONFIG_PID_NS=y
CONFIG_NET_NS=y
CONFIG_USER_NS=y
CONFIG_CGROUPS=y
CONFIG_CGROUP_FREEZER=y
CONFIG_CGROUP_PIDS=y
CONFIG_CGROUP_DEVICE=y
CONFIG_CGROUP_CPUACCT=y
CONFIG_MEMCG=y

# Container Storage (Overlay2 filesystem)
CONFIG_OVERLAY_FS=m
CONFIG_OVERLAY_FS_REDIRECT_DIR=y
CONFIG_OVERLAY_FS_INDEX=y

# Container Networking
CONFIG_BRIDGE=m
CONFIG_BRIDGE_NETFILTER=m
CONFIG_NETFILTER=y
CONFIG_NF_CONNTRACK=m
CONFIG_NF_CONNTRACK_ZONES=y
CONFIG_NF_CONNTRACK_EVENTS=y
CONFIG_IP_NF_IPTABLES=m
CONFIG_IP_NF_FILTER=m
CONFIG_IP_NF_NAT=m
CONFIG_IP_NF_TARGET_MASQUERADE=m
CONFIG_IP_NF_MANGLE=m

# Network Virtual Devices
CONFIG_VETH=m
CONFIG_MACVLAN=m
CONFIG_VXLAN=m

# Security and Capabilities for containers
CONFIG_SECURITY=y
CONFIG_SECURITYFS=y
CONFIG_SECURITY_NETWORK=y

# Process Control
CONFIG_CHECKPOINT_RESTORE=y
CONFIG_PROC_CHILDREN=y

# Essential container features
CONFIG_EVENTFD=y
CONFIG_EPOLL=y
CONFIG_SIGNALFD=y
CONFIG_TIMERFD=y
CONFIG_SHMEM=y
CONFIG_POSIX_MQUEUE=y

# Additional Docker requirements
CONFIG_RT_GROUP_SCHED=y
CONFIG_CFS_BANDWIDTH=y
CONFIG_DEVPTS_MULTIPLE_INSTANCES=y

# === Hardware Random Number Generator Support ===
# Essential for cryptographic operations and entropy generation
CONFIG_HW_RANDOM=y
CONFIG_HW_RANDOM_IMX_RNGC=y
CONFIG_HW_RANDOM_VIRTIO=y

# === CAAM Crypto Acceleration Module ===
# NXP Cryptographic Acceleration and Assurance Module for i.MX93
CONFIG_CRYPTO_DEV_FSL_CAAM=y
CONFIG_CRYPTO_DEV_FSL_CAAM_JR=y
CONFIG_CRYPTO_DEV_FSL_CAAM_CRYPTO_API=y
CONFIG_CRYPTO_DEV_FSL_CAAM_AHASH_API=y
CONFIG_CRYPTO_DEV_FSL_CAAM_RNG_API=y

# Crypto framework support
CONFIG_CRYPTO_RNG=y
CONFIG_CRYPTO_ANSI_CPRNG=y
CONFIG_CRYPTO_DRBG=y
CONFIG_CRYPTO_DRBG_HMAC=y
CONFIG_CRYPTO_DRBG_HASH=y
CONFIG_CRYPTO_DRBG_CTR=y
CONFIG_CRYPTO_JITTERENTROPY=y

# Enhanced entropy sources for better random number generation
CONFIG_RANDOM_TRUST_CPU=y
CONFIG_RANDOM_TRUST_BOOTLOADER=y
