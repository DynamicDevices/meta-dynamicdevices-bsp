# Memory power optimization for imx93-jaguar-eink (Change 6)
# DDR frequency scaling and memory power management for 5-year battery life

# === DDR Frequency Scaling ===
CONFIG_DEVFREQ=y
CONFIG_DEVFREQ_GOV_SIMPLE_ONDEMAND=y
CONFIG_DEVFREQ_GOV_POWERSAVE=y       # Use powersave governor for DDR
CONFIG_DEVFREQ_GOV_USERSPACE=y
CONFIG_ARM_IMX_BUS_DEVFREQ=y         # i.MX bus frequency scaling

# === Memory Compression for Power Savings ===
CONFIG_ZRAM=y                        # Compressed RAM
CONFIG_ZSMALLOC=y                    # Z small memory allocator
CONFIG_LZO_COMPRESS=y                # LZO compression
CONFIG_LZ4_COMPRESS=y                # LZ4 compression (faster)
CONFIG_ZRAM_DEF_COMP_LZ4=y          # Use LZ4 as default for ZRAM

# === CMA Optimization for Power ===
CONFIG_CMA=y
CONFIG_CMA_SIZE_MBYTES=16            # Reduced from 64MB to 16MB for power savings
CONFIG_CMA_SIZE_SEL_MBYTES=y
CONFIG_CMA_ALIGNMENT=8

# === Memory Management Power Optimizations ===
# Disable memory features that consume power
CONFIG_COMPACTION=n                  # Disable memory compaction
CONFIG_MIGRATION=n                   # Disable page migration
CONFIG_KSM=n                         # Disable kernel same-page merging
CONFIG_TRANSPARENT_HUGEPAGE=n        # Disable transparent huge pages
CONFIG_CLEANCACHE=n                  # Disable cleancache
CONFIG_FRONTSWAP=n                   # Disable frontswap

# === SLUB Allocator Power Optimization ===
CONFIG_SLUB=y                        # Use SLUB allocator
CONFIG_SLUB_DEBUG=n                  # Disable SLUB debug for power savings
CONFIG_SLUB_STATS=n                  # Disable SLUB stats for power savings

# === Memory Debugging Disabled for Power ===
CONFIG_DEBUG_KMEMLEAK=n              # Disable memory leak detection
CONFIG_DEBUG_OBJECTS=n               # Disable object debugging
CONFIG_DEBUG_SLAB=n                  # Disable slab debugging
CONFIG_DEBUG_PAGEALLOC=n             # Disable page allocation debugging

# === Swap and Memory Pressure ===
CONFIG_SWAP=y                        # Enable swap for memory pressure
CONFIG_ZSWAP=y                       # Compressed swap cache
CONFIG_ZSWAP_DEFAULT_ON=y            # Enable zswap by default
CONFIG_ZBUD=y                        # Zbud allocator for zswap
CONFIG_Z3FOLD=y                      # Z3fold allocator

# === Memory Reclaim Optimization ===
CONFIG_MEMORY_HOTPLUG=n              # Disable memory hotplug
CONFIG_MEMORY_HOTREMOVE=n            # Disable memory hot remove
CONFIG_NUMA=n                        # Disable NUMA (not applicable for i.MX93)

# === Page Table Management ===
CONFIG_HIGHPTE=n                     # Disable high page tables
CONFIG_ARCH_ENABLE_SPLIT_PMD_PTLOCK=n # Disable split PMD locks

# === Memory Bandwidth Optimization ===
# Configure for power-optimized memory access patterns
CONFIG_MEMCG=y                       # Memory control groups
CONFIG_MEMCG_SWAP=y                  # Swap control for memory cgroups

# === DRAM Power Management ===
# These will be configured in device tree for hardware-specific settings
# - Self-refresh timing optimization
# - Power-down modes
# - Refresh rate optimization for power
