#
# Kernel Module Signing Configuration
#
# This configuration enables cryptographic signing of kernel modules
# to ensure only trusted modules can be loaded into the kernel.
# This enhances the secure boot chain by extending verification
# from boot components to runtime loadable modules.
#

# Enable module signature verification
CONFIG_MODULE_SIG=y

# Require all modules to be validly signed
CONFIG_MODULE_SIG_FORCE=y

# Use SHA256 for module signatures (matches our secure boot chain)
CONFIG_MODULE_SIG_SHA256=y

# Disable weaker hash algorithms
# CONFIG_MODULE_SIG_SHA1 is not set
# CONFIG_MODULE_SIG_SHA224 is not set
# CONFIG_MODULE_SIG_SHA384 is not set
# CONFIG_MODULE_SIG_SHA512 is not set

# Enable signature verification for all modules
CONFIG_MODULE_SIG_ALL=y

# Use the kernel build system's signing key
# (Foundries.io will manage the actual signing keys)
CONFIG_MODULE_SIG_KEY="certs/signing_key.pem"

# Enable system keyring for additional keys
CONFIG_SYSTEM_TRUSTED_KEYRING=y
CONFIG_SYSTEM_TRUSTED_KEYS=""

# Enable module signature checking infrastructure
CONFIG_MODULE_SIG_FORMAT=y

# Security: Prevent loading of unsigned modules
# This ensures only properly signed modules can be loaded
CONFIG_SECURITY_LOCKDOWN_LSM=y
CONFIG_SECURITY_LOCKDOWN_LSM_EARLY=y
CONFIG_LOCK_DOWN_KERNEL_FORCE_NONE=y
