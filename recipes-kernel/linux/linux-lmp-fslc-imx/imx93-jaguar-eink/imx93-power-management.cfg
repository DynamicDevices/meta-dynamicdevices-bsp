# iMX93 Power Management Configuration for E-Ink Board
# Consolidated from: power-optimization.cfg, battery-power-optimization.cfg,
# cpu-frequency-scaling.cfg, memory-power-optimization.cfg, 
# peripheral-power-optimization.cfg, rtc-power-optimization.cfg
#
# Optimized for 5-year battery life with comprehensive power management

# === Core Power Management Framework ===
CONFIG_PM=y
CONFIG_PM_SLEEP=y
CONFIG_SUSPEND=y
CONFIG_PM_AUTOSLEEP=y
CONFIG_PM_WAKELOCKS=y
CONFIG_PM_WAKELOCKS_LIMIT=100
CONFIG_PM_WAKELOCKS_GC=y
CONFIG_PM_ADVANCED_DEBUG=y
CONFIG_PM_DEBUG=y
CONFIG_PM_TRACE=y
CONFIG_PM_SLEEP_DEBUG=y
CONFIG_SUSPEND_DEBUG=y

# === CPU Power Management ===
CONFIG_IMX93_LPM=y                       # i.MX93 Low Power Management driver (CRITICAL)
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_STAT=y
CONFIG_CPU_FREQ_TIMES=y
CONFIG_CPU_FREQ_DEFAULT_GOV_POWERSAVE=y

# CPU Frequency Governors (as modules for interactive control)
CONFIG_CPU_FREQ_GOV_POWERSAVE=m
CONFIG_CPU_FREQ_GOV_ONDEMAND=m
CONFIG_CPU_FREQ_GOV_CONSERVATIVE=m
CONFIG_CPU_FREQ_GOV_USERSPACE=m
CONFIG_CPU_FREQ_GOV_PERFORMANCE=m
CONFIG_CPU_FREQ_GOV_SCHEDUTIL=y

# ARM CPU Frequency Scaling Driver
CONFIG_CPUFREQ_DT=m
CONFIG_CPUFREQ_DT_PLATDEV=y
CONFIG_ARM_IMX_CPUFREQ_DT=m
CONFIG_ARM_SCPI_CPUFREQ=m
CONFIG_ARM_SCMI_CPUFREQ=m

# === CPU Idle Management ===
CONFIG_CPU_IDLE=y
CONFIG_CPU_IDLE_GOV_LADDER=y
CONFIG_CPU_IDLE_GOV_MENU=y
CONFIG_CPU_IDLE_GOV_TEO=y
CONFIG_ARM_CPUIDLE=y
CONFIG_ARM_PSCI_CPUIDLE=y

# === Dynamic Voltage and Frequency Scaling ===
CONFIG_PM_DEVFREQ=y
CONFIG_DEVFREQ_GOV_SIMPLE_ONDEMAND=y
CONFIG_DEVFREQ_GOV_POWERSAVE=y
CONFIG_DEVFREQ_GOV_USERSPACE=y
CONFIG_ARM_IMX_BUS_DEVFREQ=y

# === Power Domain Management ===
CONFIG_PM_GENERIC_DOMAINS=y
CONFIG_PM_GENERIC_DOMAINS_SLEEP=y
CONFIG_PM_GENERIC_DOMAINS_OF=y
CONFIG_IMX_GPCV2_PM_DOMAINS=y
CONFIG_PM_GENERIC_DOMAINS_RUNTIME=y
CONFIG_PM_GENERIC_DOMAINS_DEBUGFS=y

# === Runtime Power Management ===
CONFIG_PM_RUNTIME=y
CONFIG_PM_RUNTIME_CLK=y
CONFIG_PM_CLK=y

# === Memory Power Management ===
# DDR frequency scaling
CONFIG_DEVFREQ=y

# Memory compression for power savings
CONFIG_ZRAM=y
CONFIG_ZSMALLOC=y
CONFIG_LZO_COMPRESS=y
CONFIG_LZ4_COMPRESS=y
CONFIG_ZRAM_DEF_COMP_LZ4=y

# CMA optimization for power
CONFIG_CMA=y
CONFIG_CMA_SIZE_MBYTES=16            # Reduced from 64MB to 16MB for power savings
CONFIG_CMA_SIZE_SEL_MBYTES=y
CONFIG_CMA_ALIGNMENT=8

# Memory management power optimizations
CONFIG_COMPACTION=n                  # Disable memory compaction
CONFIG_MIGRATION=n                   # Disable page migration
CONFIG_KSM=n                         # Disable kernel same-page merging
CONFIG_TRANSPARENT_HUGEPAGE=n        # Disable transparent huge pages
CONFIG_CLEANCACHE=n                  # Disable cleancache
CONFIG_FRONTSWAP=n                   # Disable frontswap

# SLUB allocator power optimization
CONFIG_SLUB=y
CONFIG_SLUB_DEBUG=n                  # Disable SLUB debug for power savings
CONFIG_SLUB_STATS=n                  # Disable SLUB stats for power savings

# Memory debugging disabled for power
CONFIG_DEBUG_KMEMLEAK=n              # Disable memory leak detection
CONFIG_DEBUG_OBJECTS=n               # Disable object debugging
CONFIG_DEBUG_SLAB=n                  # Disable slab debugging
CONFIG_DEBUG_PAGEALLOC=n             # Disable page allocation debugging

# Swap and memory pressure
CONFIG_SWAP=y

# === Peripheral Power Management ===
# Note: Basic peripheral configs are in imx93-core-system.cfg
# This section only contains power-specific peripheral settings

# USB power management
CONFIG_USB_SUSPEND=y
CONFIG_USB_DEFAULT_PERSIST=y

# === Regulator Support for DVFS ===
# Note: Basic regulator configs are in imx93-core-system.cfg
# This section only contains power/DVFS-specific regulator settings
CONFIG_REGULATOR_ANATOP=y
CONFIG_REGULATOR_PCA9450=y  # PMIC support for voltage scaling

# === Thermal Management for Power ===
CONFIG_THERMAL=y
CONFIG_THERMAL_DEFAULT_GOV_STEP_WISE=y
CONFIG_THERMAL_GOV_FAIR_SHARE=y
CONFIG_THERMAL_GOV_STEP_WISE=y
CONFIG_THERMAL_GOV_USER_SPACE=y
CONFIG_THERMAL_GOV_POWER_ALLOCATOR=y
CONFIG_THERMAL_EMULATION=y
CONFIG_IMX_THERMAL=y
CONFIG_IMX_SC_THERMAL=y

# === RTC Power Optimization ===
# Note: External PCF2131 RTC is primary system RTC (configured in pcf2131-rtc.cfg)
# Internal BBNSM RTC disabled in device tree for power savings and IRQ conflict prevention
# CONFIG_RTC_DRV_IMX_SC is not set
# CONFIG_RTC_DRV_SNVS is not set

# RTC power management interfaces
CONFIG_RTC_INTF_SYSFS=y
CONFIG_RTC_INTF_PROC=y
CONFIG_RTC_INTF_DEV=y

# === Network Power Management ===
# Note: Network configs are in imx93-wireless.cfg
# This section only contains power-specific network settings
# (Currently no power-specific network settings needed)

# === Battery Optimization Features ===
# Kernel optimizations for 5-year battery life
CONFIG_NO_HZ=y
CONFIG_NO_HZ_COMMON=y
CONFIG_NO_HZ_IDLE=y
CONFIG_NO_HZ_FULL=y

# RCU optimizations
CONFIG_RCU_NOCB_CPU=y
CONFIG_RCU_NOCB_CPU_DEFAULT_ALL=y
CONFIG_RCU_NOCB_CPU_CB_BOOST=y

# CPU isolation support
CONFIG_CPU_ISOLATION=y
CONFIG_SCHED_ISOLATION=y

# IRQ management
CONFIG_IRQ_FORCED_THREADING=y
CONFIG_IRQ_FORCED_THREADING_DEFAULT=y

# === Advanced PM Features ===
# Timer optimizations
CONFIG_HIGH_RES_TIMERS=y
CONFIG_GENERIC_CLOCKEVENTS=y

# === Tracing Support for PM Debugging ===
# Note: These are power management specific tracing features
CONFIG_FTRACE=y
CONFIG_DYNAMIC_FTRACE=y
CONFIG_FUNCTION_TRACER=y
CONFIG_IRQSOFF_TRACER=y
CONFIG_PREEMPT_TRACER=y
