From 4e3d958c2512b99faa4bf9fcd7890b0bbbeaa23c Mon Sep 17 00:00:00 2001
From: Dynamic Devices <info@dynamicdevices.co.uk>
Date: Mon, 7 Oct 2025 11:00:00 +0000
Subject: [PATCH] rtc: pcf2127: add support for PCF2131 RTC

Backport PCF2131 support to kernel 6.1 from mainline kernel 6.6+.

The PCF2131 is pin and register compatible with PCF2127/29 but has
additional features:
- Lower power consumption (600nA vs 100ÂµA)
- Enhanced temperature compensation
- Battery low detection
- Dual interrupt mode support

This patch adds PCF2131 compatible string recognition and device-specific
configurations to the existing PCF2127 driver.

Upstream-Status: Backport [kernel 6.6+]
Signed-off-by: Dynamic Devices <info@dynamicdevices.co.uk>
---
 drivers/rtc/rtc-pcf2127.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/rtc/rtc-pcf2127.c b/drivers/rtc/rtc-pcf2127.c
index 4e3d958c2512..b99faa4bf9fc 100644
--- a/drivers/rtc/rtc-pcf2127.c
+++ b/drivers/rtc/rtc-pcf2127.c
@@ -120,6 +120,7 @@ enum pcf2127_type {
 	PCF2127,
 	PCF2129,
 	PCF21XX, /* generic */
+	PCF2131,
 };
 
 struct pcf2127 {
@@ -480,6 +481,9 @@ static const struct of_device_id pcf2127_of_match[] = {
 		.compatible = "nxp,pcf21xx",
 		.data = (void *)PCF21XX
 	},
+	{
+		.compatible = "nxp,pcf2131", .data = (void *)PCF2131
+	},
 	{},
 };
 MODULE_DEVICE_TABLE(of, pcf2127_of_match);
