# ===== ALSA config for TAS2563 with integrated microphones =====

# ---- Physical Speaker (TAS2563 playback) ----
pcm.spk {
    type hw
    card tas2563audio
    device 0
    subdevice 0
    format S16_LE
    rate 16000
    channels 1
}
ctl.spk { type hw card tas2563audio}

pcm.spk_vc {
    type softvol
    slave.pcm "spk"
    control {
        name "Soft Speaker Volume"
        card tas2563audio
    }
    min_dB -60.0
    max_dB 0.0
    resolution 100
}

pcm.!default {
    type plug
    slave {
        pcm "spk_vc"
        format S16_LE
        rate 16000
        channels 1
    }
}

ctl.!default { type hw card tas2563audio}

# ---- TAS2563 Microphone Input (capture) ----
pcm.mic {
    type hw
    card tas2563audio
    device 0
    subdevice 1  # Capture subdevice
}
ctl.mic { type hw card tas2563audio }

# Alternative microphone configuration with explicit parameters
pcm.tas2563_mic {
    type hw
    card tas2563audio
    device 0
    subdevice 1
    format S16_LE
    rate 16000
    channels 2
}

# Microphone with software volume control
pcm.mic_vc {
    type softvol
    slave.pcm "mic"
    control {
        name "Soft Mic Volume"
        card tas2563audio
    }
    min_dB -30.0
    max_dB 20.0
    resolution 100
}

# ---- Loopback pair 0: Azure TTS -> AEC probe ----
pcm.loop_playback_far {  # write here from Azure TTS
    type hw
    card Loopback
    device 0
    subdevice 0
}
pcm.loop_capture_far {   # read here for webrtcechoprobe
    type hw
    card Loopback
    device 1
    subdevice 0
}

# ---- Loopback pair 1: AEC output -> consumers (e.g., STT) ----
pcm.loop_playback_near {  # AEC writes cleaned audio here
    type hw
    card Loopback
    device 0
    subdevice 1
}
pcm.loop_capture_near {   # single-open reader of cleaned audio
    type hw
    card Loopback
    device 1
    subdevice 1
}

# Optional multi-open reader of cleaned audio (use if multiple apps read it)
pcm.loop_capture_near_multi {
    type dsnoop
    ipc_key 673057
    ipc_perm 0666
    slave {
        pcm "hw:Loopback,1,1"
        format S16_LE
        rate 16000
        channels 1
    }
}

# ---- TAS2563-specific configurations ----

# Full-duplex configuration for TAS2563 (simultaneous playback and capture)
pcm.tas2563_duplex {
    type asym
    playback {
        pcm "spk"
        format S16_LE
        rate 16000
        channels 1
    }
    capture {
        pcm "mic"
        format S16_LE
        rate 16000
        channels 2
    }
}

# Stereo microphone capture (if TAS2563 supports stereo mics)
pcm.tas2563_stereo_mic {
    type hw
    card tas2563audio
    device 0
    subdevice 1
    format S32_LE
    rate 48000
    channels 2
}

# High-quality capture configuration
pcm.tas2563_hq_capture {
    type plug
    slave {
        pcm "tas2563_stereo_mic"
        format S32_LE
        rate 48000
        channels 2
    }
    ttable.0.0 1.0
    ttable.1.1 1.0
}
