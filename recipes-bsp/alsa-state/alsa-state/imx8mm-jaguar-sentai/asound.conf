# ===== Minimal ALSA config for AEC =====

# ---- Physical Speaker (used by pipeline as "spk") ----
pcm.spk {
    type hw
    card tas2563audio
    device 0
}
ctl.spk { type hw card tas2563audio}

pcm.spk_vc {
    type softvol
    slave.pcm "spk"
    control {
        name "Soft Speaker Volume"
        card tas2563audio
    }
    min_dB -60.0
    max_dB 0.0
    resolution 100
}

pcm.!default {
    type plug
    slave.pcm "spk_vc"
}

ctl.!default { type hw card tas2563audio}

# ---- Physical Microphone (used by pipeline as "mic") ----
pcm.mic {
    type hw
    card micfilaudio
    device 0
}
ctl.mic { type hw card micfilaudio }

# ---- Loopback pair 0: Azure TTS -> AEC probe ----
pcm.loop_playback_far {  # write here from Azure TTS
    type hw
    card Loopback
    device 0
    subdevice 0
}
pcm.loop_capture_far {   # read here for webrtcechoprobe
    type hw
    card Loopback
    device 1
    subdevice 0
}

# ---- Loopback pair 1: AEC output -> consumers (e.g., STT) ----
pcm.loop_playback_near {  # AEC writes cleaned audio here
    type hw
    card Loopback
    device 0
    subdevice 1
}
pcm.loop_capture_near {   # single-open reader of cleaned audio
    type hw
    card Loopback
    device 1
    subdevice 1
}

# Optional multi-open reader of cleaned audio (use if multiple apps read it)
pcm.loop_capture_near_multi {
    type dsnoop
    ipc_key 673057
    ipc_perm 0666
    slave {
        pcm "hw:Loopback,1,1"
        format S16_LE
        rate 16000
        channels 1
    }
}
